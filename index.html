<html lang="en">
<head>
    <!-- Google Tag Manager container-->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWWTRQ9R');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IFrame</title>
    <style>
        #logs div {
            border-bottom: 0.1em solid red;
        }
    </style>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RVZMH81TNP');
</script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWWTRQ9R"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    
    <h2 id="title">IFrame site</h2>
    
    <input type="text" id="messageTxt" placeholder="Message to parent">
    <button id="sendBtn">Send to parent</button>
    <button id="resEvent1">Send Res_Event_Success</button>
    <button id="resEvent2">Send Res_Event_Fail</button>

    <div id="logs"></div>

    <script>
        (function () {
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'registrationComplete'
            });

            let resBtn1 = document.getElementById("resEvent1");
            let resBtn2 = document.getElementById("resEvent2");
            resBtn1.addEventListener('click', function() {
                window.dataLayer.push({
                    'event': 'Res_Event_Success'
                });
            })
            resBtn2.addEventListener('click', function() {
                window.dataLayer.push({
                    'event': 'Res_Event_Fail'
                });
            })
            
            title.textContent += ` ${location}`;
            
            const parentDomain = "https://conversion.resulticks.net";
            const parentDomain1 = "https://resulticks.net"

            window.onmessage = event => {
                console.log("Message Received");
                if(event.origin === parentDomain) {
                    console.log("Domain matches")

                    let eventData = event.data;
                    console.log("eventdata", eventData);
                    if (event.data.action === 'writeToLocalStorage') {
                        console.log("Message received on iframe site:", event.data);
                        localStorage.setItem('passportId', eventData.passportId);
                        localStorage.setItem('profileId', eventData.profileId);
                        // window.parent.postMessage({
                        //     action: 'writeToLocalStorage',
                        //     Resul_Profile_Id: event.data.Resul_Profile_Id,
                        //     Res_Passport_Id: event.data.Res_Passport_Id,
                        //     Res_Profile_Id: event.data.Res_Profile_Id,
                        //     deviceToken: event.data.deviceToken
                        // }, parentDomain);
                    }
                }
            };

            sendBtn.onclick = event => {
                window.parent.postMessage(messageTxt.value, parentDomain);
            }
        })();
    </script>
</body>
</html>
