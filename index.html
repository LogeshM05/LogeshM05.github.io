<html lang="en">
<head>
    <meta name="google-signin-client_id" content="795171808898-esffb3asbi3pnqk1foj0ei1qspqji6vn.apps.googleusercontent.com">
    <!-- Google Tag Manager container-->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-PWWTRQ9R');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RESUL</title>
    <style>
        #logs div {
            border-bottom: 0.1em solid red;
        }
    </style>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-RVZMH81TNP');
</script>
    <!--Google-->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PWWTRQ9R"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    
    <h2 id="title">RESUL SDK Integration via gTAG</h2>
    <div class="g-signin2" data-onsuccess="onSignIn"></div> <!--Google signin btn-->
    <a href="#" onclick="signOut();">Sign out</a>

    <div id="logs"></div>

    <script>
        (function () {
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'registrationComplete'
            });

            let resBtn1 = document.getElementById("resEvent1");
            let resBtn2 = document.getElementById("resEvent2");
            resBtn1.addEventListener('click', function() {
                window.dataLayer.push({
                    'event': 'Res_Event_Success'
                });
            })
            resBtn2.addEventListener('click', function() {
                window.dataLayer.push({
                    'event': 'Res_Event_Fail'
                });
            })
            
            title.textContent += ` ${location}`;
            
            const parentDomain = "https://conversion.resulticks.net";
            const parentDomain1 = "https://karthikrathinavel.github.io"
            let dataArray = [];
            window.onmessage = event => {
                console.log("Message Received");
                if(event.origin === parentDomain || event.origin === parentDomain1) {
                    console.log("Domain matches")

                    let eventData = event.data;
                    console.log("eventdata", eventData);
                    if (event.data.action === 'writeToLocalStorage') {
                        console.log("Message received on iframe site:", event.data);
                        localStorage.setItem('domain', eventData.currentDomain);
                        localStorage.setItem('pId', eventData.passportId);
                        localStorage.setItem('prId', eventData.profileId);
                    }
                }
                // if (event.origin === 'https://karthikrathinavel.github.io') {
                //     event.source.postMessage(dataArray, event.origin);
                // }
            };

            sendBtn.onclick = event => {
                window.parent.postMessage(messageTxt.value, parentDomain);
            }
        })();
        function onSignIn(googleUser) {
          var profile = googleUser.getBasicProfile();
          console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
          console.log('Name: ' + profile.getName());
          console.log('Image URL: ' + profile.getImageUrl());
          console.log('Email: ' + profile.getEmail()); // This is null if the 'email' scope is not present.
        }
        function signOut() {
            var auth2 = gapi.auth2.getAuthInstance();
            auth2.signOut().then(function () {
              console.log('User signed out.');
            });
        }
    </script>
</body>
</html>
